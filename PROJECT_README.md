# 📚 网文拆书学习工具套件

一套完整的网络小说学习工具，帮助网文作者和爱好者从优秀作品中学习写作技法。

## 🎯 项目愿景

写作是一门需要不断学习和实践的技艺。阅读优秀作品是提升写作能力的重要途径，但单纯的阅读往往难以系统性地提炼出可借鉴的写作技法。

本项目旨在通过 AI 技术，帮助用户：
- 🔍 **深度分析**：从人物塑造、情节设计、写作技法等多维度拆解小说
- 📝 **结构化笔记**：自动生成可复用的学习笔记
- 💬 **交互式学习**：针对具体问题进行深度追问
- 📊 **Token 追踪**：预估和记录 API 消耗，控制分析成本

## 🧩 项目组成

```
┌─────────────────────────────────────────────────────────────┐
│                     网文拆书学习工具套件                       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────┐         ┌─────────────────────────┐   │
│  │   SoNovel       │  HTTP   │   NovelCraft            │   │
│  │   小说下载服务   │ ──────► │   Obsidian 分析插件     │   │
│  │                 │         │                         │   │
│  │  • 多书源搜索   │         │  • epub 解析            │   │
│  │  • epub 下载    │         │  • AI 智能分析          │   │
│  │  • WebUI/CLI    │         │  • 笔记自动生成         │   │
│  │  • Docker 部署  │         │  • 交互式追问           │   │
│  └─────────────────┘         └─────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 1️⃣ SoNovel - 小说下载服务

基于 [freeok/so-novel](https://github.com/freeok/so-novel) 修改的小说下载工具，增加了 Docker 部署和 CORS 支持。

**主要功能：**
- 🔎 多书源聚合搜索
- � 自动源下载为 epub 格式
- 🌐 WebUI 和 CLI 双模式
- 🐳 Docker 一键部署

### 2️⃣ NovelCraft - Obsidian 分析插件

一款 Obsidian 插件，利用 AI 深度分析小说的写作技法，并生成结构化学习笔记。

**主要功能：**
- 📖 epub 文件解析
- 🤖 AI 智能分析（支持多种 LLM）
- 📝 自动生成结构化笔记
- 💬 交互式追问对话（侧边栏视图，流式响应）
- 📊 Token 消耗预估与统计

**分析维度：**

| 分析项 | 快速模式 | 标准模式 | 深度模式 |
|--------|:--------:|:--------:|:--------:|
| 故事梗概 | ✅ | ✅ | ✅ |
| 人物分析 | ✅ | ✅ | ✅ |
| 写作技法 | ✅ | ✅ | ✅ |
| 可借鉴清单 | ✅ | ✅ | ✅ |
| 情绪曲线 | - | ✅ | ✅ |
| 章节结构 | - | ✅ | ✅ |
| 伏笔分析 | - | ✅ | ✅ |
| 逐章拆解 | - | - | ✅ |
| 写作复盘 | - | - | ✅ |

**支持的小说类型：**
都市、玄幻、仙侠、武侠、科幻、历史、悬疑、言情、游戏、末日、轻小说、同人、自定义

## 🚀 快速开始

### 方式一：完整部署（推荐）

同时部署 SoNovel 和 NovelCraft，获得完整的搜索、下载、分析体验。

#### 步骤 1：部署 SoNovel 服务

```bash
# 使用 Docker Compose 一键部署
docker-compose up -d

# 服务将在 http://localhost:7765 启动
```

#### 步骤 2：安装 NovelCraft 插件

1. 下载 `novel-craft` 目录
2. 在目录中执行 `npm install && npm run build`
3. 复制到 Obsidian 插件目录：`<vault>/.obsidian/plugins/novel-craft/`
4. 在 Obsidian 设置中启用插件

#### 步骤 3：配置插件

1. **配置 LLM 服务**
   - 打开 Obsidian 设置 → NovelCraft
   - 添加 LLM 服务商（支持 OpenAI、Claude、DeepSeek 等）

2. **配置 SoNovel 地址**
   - 设置 SoNovel 服务地址为 `http://localhost:7765`

#### 步骤 4：开始使用

1. 点击 Obsidian 左侧 📚 图标打开主面板
2. 在 "搜索" 标签页搜索想要分析的小说
3. 下载完成后，点击 "分析" 开始 AI 分析
4. 分析完成后，点击 "💬 打开对话" 进行追问

### 方式二：仅使用分析功能

如果你已有 epub 文件，可以只安装 NovelCraft 插件。

1. 安装 NovelCraft 插件
2. 配置 LLM 服务
3. 将 epub 文件拖入 Obsidian Vault
4. 在主面板中选择文件进行分析

## 📁 生成的笔记示例

```
NovelCraft/notes/
└── 诡秘之主/
    ├── 00-概览.md          # 书籍信息、故事梗概
    ├── 01-人物图谱.md      # 人物分析、关系网络
    ├── 02-情节分析.md      # 章节结构、情绪曲线、伏笔
    ├── 03-写作技法.md      # 技法总结、可借鉴清单
    └── 章节笔记/           # 深度模式下的逐章分析
        ├── 001-序章.md
        ├── 002-第一章.md
        └── ...
```

## 🔧 高级用法

### 分析特定章节范围

对于长篇网文，建议分段分析以节省 Token：

1. 在分析面板选择 "自定义" 范围
2. 设置起始和结束章节
3. 使用快捷按钮：前10章、前30章、前50章、前100章

### Token 消耗管理

- **预估功能**：开始分析前显示预估 Token 消耗
- **实时统计**：分析过程中显示实际消耗
- **历史记录**：在设置中查看累计消耗统计

### 控制分析过程

- **暂停**：暂停当前分析，可随时继续
- **终止**：停止分析，已生成的笔记会保留

### 交互式追问

分析完成后，点击主面板的 "💬 打开对话" 按钮：

- 在侧边栏中进行追问，不阻塞文档操作
- 流式响应，实时显示 AI 回答进度
- 可选择特定章节进行针对性讨论
- 对话可保存为笔记

### 自定义提示词

NovelCraft 支持自定义分析提示词：

1. 打开设置 → NovelCraft → 提示词自定义
2. 选择要修改的分析阶段或小说类型
3. 编辑提示词内容
4. 保存后生效

## ⚙️ 配置说明

### SoNovel 配置

编辑 `config.ini` 文件：

```ini
[web]
enabled = 1
port = 7765

[download]
path = downloads
interval = 500
```

### NovelCraft 配置

| 配置项 | 说明 |
|--------|------|
| SoNovel 服务地址 | 下载服务的 HTTP 地址 |
| 下载保存路径 | epub 文件保存目录 |
| 笔记保存路径 | 分析笔记保存目录 |
| LLM 服务 | AI 服务配置（API 地址、密钥、模型） |
| 默认分析模式 | 快速/标准/深度 |
| 默认小说类型 | 都市/玄幻/仙侠等 |

## ❓ 常见问题

### Q: 分析一本书需要多少 Token？

取决于书籍长度和分析模式：
- 快速模式：约 10-30k tokens
- 标准模式：约 30-80k tokens
- 深度模式：约 80-200k tokens

插件会在分析前显示预估消耗，建议使用自定义章节范围来控制成本。

### Q: 支持哪些 LLM 服务？

支持所有 OpenAI 兼容的 API：
- OpenAI (GPT-4, GPT-3.5)
- Anthropic Claude
- DeepSeek
- 本地部署的 LLM（如 Ollama）

### Q: 如何使用追问对话功能？

1. 完成一本书的分析
2. 点击主面板底部的 "💬 打开对话" 按钮
3. 在右侧边栏中输入问题进行追问
4. 可选择特定章节获得更精准的回答

## 🛠️ 开发

### NovelCraft

```bash
cd novel-craft
npm install
npm run dev    # 开发构建
npm run build  # 生产构建
npm test       # 运行测试
```

## 📋 系统要求

### SoNovel
- Docker 和 Docker Compose
- 或 Java 21+ 运行环境

### NovelCraft
- Obsidian 1.0.0+
- 可用的 LLM API

## 📄 许可证

MIT License

## 🙏 致谢

- [SoNovel](https://github.com/freeok/so-novel) - 原版小说下载工具
- [Obsidian](https://obsidian.md/) - 知识管理工具
- [JSZip](https://stuk.github.io/jszip/) - epub 解析支持

## ⚠️ 声明

本项目中的 SoNovel 服务基于 [freeok/so-novel](https://github.com/freeok/so-novel) 修改而来，增加了 Docker 化部署支持和与 NovelCraft 插件的集成适配。原项目的使用问题请前往 [原项目 Issues](https://github.com/freeok/so-novel/issues) 反馈。
