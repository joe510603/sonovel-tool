# 交互式拆书系统使用指南

## 概述

交互式拆书系统是 NovelCraft 插件的核心功能模块，专为网络小说创作者设计。该系统允许您在阅读过程中手动标记和拆解小说结构，结合 AI 智能分析，帮助您积累写作素材库和学习叙事结构套路。

## 快速开始

### 1. 启用交互式标记工具栏

1. 打开 Obsidian 设置 → NovelCraft
2. 找到「交互式标记」设置区域
3. 启用「显示交互式标记工具栏」选项

### 2. 基本标记流程

1. **打开章节文件** - 在 NovelCraft 书库中打开任意章节
2. **定位光标** - 将光标放置在要标记的起始位置
3. **插入开始标记** - 点击工具栏的「开始标记」按钮
4. **移动到结束位置** - 将光标移动到标记范围的结束位置
5. **插入结束标记** - 点击「结束标记」按钮
6. **选择标记类型** - 在弹出的选择框中选择标记类型

## 核心功能

### 插入式标记系统

#### 标记类型

| 类型 | 说明 | 颜色 |
|------|------|------|
| 故事情节 | 具有完整起承转合的叙事单元 | 红色 |
| 设定信息 | 世界观、境界体系、功法等设定 | 青色 |
| 场景 | 具体的场景描写 | 蓝色 |
| 人物出场 | 人物的出场和描写 | 绿色 |

#### 故事情节子类型

- **主线** - 主要故事线
- **支线** - 次要故事线
- **独立故事** - 独立的小故事
- **自定义** - 用户自定义类型

#### 设定信息分类

- 境界设定
- 功法体系
- 世界观
- 道具设定
- 势力关系
- 自定义分类

### 跨章节标记

交互式标记系统支持跨越多个章节的标记：

1. 在第一章插入开始标记
2. 翻到后续章节
3. 在目标位置插入结束标记
4. 系统会自动提取所有包含章节的内容

### 并行标记

您可以同时进行多个故事的标记：

1. 插入多个开始标记（不同位置）
2. 在侧边栏查看所有未配对的标记
3. 按需要的顺序完成各个标记的配对

### 嵌套标记

支持标记的嵌套结构：

- 外层标记可以包含内层标记
- 系统会自动计算嵌套层级
- 不同层级使用不同的视觉样式区分

## AI 分析模板

### 内置模板

#### 七步法分析

专为网文爽文套路设计的分析模板：

1. **优势展示** - 主角展现优势或潜力
2. **反派出场** - 反派登场制造信息差
3. **初步交锋** - 主角与反派势力摩擦
4. **反派行动** - 反派基于信息差行动
5. **冲突爆发** - 正面冲突最终爆发
6. **震惊四座** - 主角表现震惊众人
7. **收获奖励** - 获得收获并继续震惊

### 自定义模板

1. 打开模板管理界面
2. 点击「创建新模板」
3. 填写模板名称和描述
4. 添加分析步骤和要点
5. 设置提示词模板
6. 保存模板

### 模板导入导出

- 支持将模板导出为 JSON 格式
- 可以导入他人分享的模板
- 便于团队协作和模板共享

## 素材库管理

### 跨书籍素材库

所有标记的设定信息会自动汇总到跨书籍素材库：

1. 打开素材库面板
2. 按分类浏览所有设定
3. 查看不同书籍的设定对比
4. 检测和处理设定冲突

### 设定冲突检测

当标记相同类型的设定时，系统会：

1. 自动检测可能的重复或冲突
2. 提示用户确认或合并
3. 记录冲突信息供后续处理

## 人物追踪

### 人物出场标记

1. 选择包含人物描写的文本
2. 选择「人物出场」标记类型
3. 输入或选择人物名称
4. 设置出场重要程度

### 人物故事线

系统会自动汇总每个人物的：

- 所有出场场景
- 相关故事情节
- 与主线的交集点
- 人物关系网络

## 数据导出

### 支持的导出格式

| 格式 | 说明 | 用途 |
|------|------|------|
| Markdown | 结构化文档 | 笔记整理 |
| JSON | 完整数据 | 数据备份 |
| CSV | 表格数据 | 数据分析 |

### 导出内容

- 所有标记和标记对
- 分析结果和报告
- 设定信息汇总
- 人物追踪数据

## 快捷键

| 快捷键 | 功能 |
|--------|------|
| `Ctrl/Cmd + Shift + S` | 插入开始标记 |
| `Ctrl/Cmd + Shift + E` | 插入结束标记 |
| `Ctrl/Cmd + Shift + M` | 打开标记管理 |
| `Ctrl/Cmd + Shift + T` | 打开追踪面板 |

## 界面说明

### 浮动工具栏

位于编辑器顶部，包含：

- 开始标记按钮
- 结束标记按钮
- 快速标记按钮（故事/设定/场景/人物）
- 设置按钮

### 标记管理侧边栏

显示当前书籍的所有标记：

- 进行中的标记（未配对）
- 已完成的标记（已配对）
- 标记的快速导航
- 标记的编辑和删除

### 分析结果面板

展示 AI 分析结果：

- 结构化分析报告
- 情绪曲线图表
- 角色作用分析
- 写作技法总结

## 最佳实践

### 标记策略

1. **先粗后细** - 先标记大的故事情节，再标记内部细节
2. **及时配对** - 插入开始标记后尽快完成配对
3. **合理分类** - 选择最合适的标记类型
4. **添加备注** - 为重要标记添加备注说明

### 分析技巧

1. **选择合适模板** - 根据故事类型选择分析模板
2. **编辑完善** - AI 分析结果可以手动编辑完善
3. **对比学习** - 对比不同书籍的相似情节
4. **积累素材** - 将优秀的设定和技法加入素材库

### 性能优化

1. **定期导出** - 定期导出数据作为备份
2. **清理缓存** - 如遇性能问题可清理缓存
3. **分批处理** - 大量标记时分批进行

## 常见问题

### Q: 标记后找不到了怎么办？

A: 打开标记管理侧边栏，可以看到所有标记列表，点击可快速跳转。

### Q: 如何修改已完成的标记？

A: 在标记管理侧边栏中找到对应标记，点击编辑按钮进行修改。

### Q: AI 分析失败怎么办？

A: 检查 LLM 服务配置是否正确，或稍后重试。系统会自动保存标记，分析可以稍后进行。

### Q: 如何处理设定冲突？

A: 在素材库中查看冲突详情，选择保留、合并或创建新条目。

### Q: 数据存储在哪里？

A: 标记数据存储在 `.novelcraft/interactive-marks/` 目录下，每本书一个 JSON 文件。

## 更新日志

### v1.5.0

- 新增交互式拆书系统
- 支持跨章节标记
- 集成 AI 分析模板
- 添加跨书籍素材库
- 人物追踪系统
- 场景属性标签
- 数据导出功能
- 统一错误处理
- 用户引导系统
- 性能优化
- 230 个测试用例覆盖

## 反馈与支持

如有问题或建议，请通过以下方式联系：

- GitHub Issues
- 社区论坛
- 邮件反馈

---

*NovelCraft - 让小说创作更高效*
